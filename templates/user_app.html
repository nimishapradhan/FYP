{% extends "user_nav.html" %}
{% load static %}
{% block title %} Dashboard {% endblock %}
{% block content %}

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        overflow: auto; /* Add overflow property for the table */
    }

    /* Zebra striping */
    tr:nth-of-type(odd) {
        background: #eee;
    }

    th {
        background: #88b4ab;
        color: black;
        font-weight: bold;
    }

    td,
    th {
        padding: 1rem;
        border: 1px solid #ccc;
        text-align: center;
    }

    @media only screen and (max-width: 760px),
    (min-device-width: 768px) and (max-device-width: 1024px) {
        /* Force table to not be like tables anymore */
        table,
        thead,
        tbody,
        th,
        td,
        tr {
            display: block;
        }

        /* Hide table headers (but not display: none;, for accessibility) */
        thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        tr {
            border: 1px solid #ccc;
        }

        td {
            /* Behave like a "row" */
            border: none;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 50%;
        }

        td:before {
            /* Now like a table header */
            position: absolute;
            /* Top/left values mimic padding */
            top: 6px;
            left: 6px;
            width: 45%;
            padding-right: 10px;
            white-space: nowrap;
        }

        /*
        Label the data
        */
        td:nth-of-type(1):before {
            content: "Date";
        }
        td:nth-of-type(2):before {
            content: "Vet Name";
        }
        td:nth-of-type(3):before {
            content: "Appointment Type";
        }
        td:nth-of-type(4):before {
            content: "Service Type";
        }
        td:nth-of-type(5):before {
            content: "Instructions";
        }
        td:nth-of-type(6):before {
            content: "Action";
        }
    }

    /* Style for the "Book Appointment" button */
    .btn-green {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        font-size: 1rem;
        text-decoration: none;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-green:hover {
        background-color: #45a049;
    }

    /* Time Slot styling */
    .time-slot-container {
        width: 100%;
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .time-slot-btn {
        width: 100px;
        height: 40px;
        margin: 5px;
        text-align: center;
        line-height: 40px;
        cursor: pointer;
        border: 1px solid #ced4da;
        border-radius: 5px;
        margin-right: 10px;
        font-size: 0.9rem;
        transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
    }

    .available {
        background-color: #53b742;
        color: white;
    }

    .booked {
        background-color: #dc3545;
        color: white;
    }

    .time-slot-btn:hover {
        background-color: #4c9f3e;
    }
</style>


        <!-- Add a dropdown for selecting doctors -->
        <div class="container">
            <div class="doctor-selection-container py-4">
                <label for="doctor-select" class="form-label fs-4">Select Doctor:</label>
                <select id="doctor-select" class="form-select">
                    <option value="lujana">Lujana</option>
                    <option value="dhiraj">Dhiraj</option>
                    <option value="manoj">Manoj</option>
                </select>
            </div>
        </div>
      

        <!-- Display time slots for booking -->
        <div class="time-slots-container py-5">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="fs-4">Bookable Time Slots</div>
                </div>

                <hr />
                <div class="time-slots">
                    <!-- Time slots will be dynamically generated and updated based on the selected doctor -->
                </div>
            </div>
        </div>



<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="fs-4">My Appointment History</div>
        <!-- Add appointment button with link to the booking page -->
        <a href="{% url 'booking' %}" class="text-decoration-none">
            <button type="button" class="book-appointment-btn btn btn-green">Book appointment</button>
        </a>
    </div>

    <div class = "input-group input-group-sm mb-3 mt-4">
        <input type="text" class="form-control" id="search" placeholder="Search for...">
        <a href = "user_app" class="btn btn-primary" style="margin: left 2px;"> <i class="fa-solid fa-magnifying-glass"></i> </a>
    </div>

    <hr />

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Vet</th>
                <th>Appointment Type</th>
                <th>Service Type</th>
                <th>Instructions</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for app in appointments %}
                <tr>
                    <td>{{ app.date }}</td>
                    <td>{{ app.vet }}</td>
                    <td>{{ app.appointment_type }}</td>
                    <td>{{ app.service_type }}</td>
                    <td>none</td>
                    <td>
                        <a href="{% url 'delete_appointment' %}" class="btn btn-danger delete-appointment" title="Delete product" data-appointment-id="{{ app.id }}">
                          <!-- <i class="fa-solid fa-trash"></i> -->
                          Delete
                        </a>
                      </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const doctorSelect = document.querySelector('#doctor-select');
        const timeSlotsContainer = document.querySelector('.time-slots');

        function updateSlots(selectedDoctor) {
            const url = `/myapp/get_booked_time_slots/${selectedDoctor}/`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    timeSlotsContainer.innerHTML = '';

                    let currentTime = new Date();
                    currentTime.setHours(9, 0, 0, 0);

                    for (let i = 0; i < 24; i++) {
                        const time = currentTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        if (data.booked_time_slots.includes(time)) {
                            // If the time slot is booked for the selected doctor, skip it
                            currentTime.setMinutes(currentTime.getMinutes() + 20);
                            continue;
                        }

                        const button = document.createElement("button");
                        button.className = "time-slot-btn available";
                        button.textContent = time;
                        button.addEventListener("click", function () {
                            alert(`Booked ${time} for ${selectedDoctor}`);
                        });
                        timeSlotsContainer.appendChild(button);

                        currentTime.setMinutes(currentTime.getMinutes() + 20);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Initial update with the default selected doctor
        updateSlots(doctorSelect.value);

        // Add event listener to update time slots when the doctor is changed
        doctorSelect.addEventListener('change', function () {
            const selectedDoctor = this.value;
            updateSlots(selectedDoctor);
        });
    });

</script>

<script>

/* Crud */

        $(document).ready(function () {
            $(".delete-appointment").click(function () {
                var appointmentId = $(this).data("appointment-id");

                // Make an AJAX request to delete the appointment
                $.ajax({
                    url: '/delete_appointment/',
                    type: 'POST',
                    data: {
                        'appointment_id': appointmentId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function (data) {
                        // Refresh the page or update the UI as needed
                        location.reload();
                    },
                    error: function (error) {
                        console.error('Error deleting appointment:', error);
                        // Handle error as needed
                    }
                });
            });
        });
    </script>
    
   
    



{% endblock %}
