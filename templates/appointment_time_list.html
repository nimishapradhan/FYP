<!-- appointment_time_list.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Appointment Times</title>
</head>
<body>
    <h2>Available Appointment Times</h2>
    <ul>
        {% for time in available_times %}
            <li>
                {{ time }}
                {% if user.is_authenticated %}
                    <button onclick="bookAppointment('{{ time.id }}')">Book</button>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <!-- appointment_time_list.html -->

<!-- ... (previous HTML code) ... -->

<script>
    function bookAppointment(timeId) {
        // Perform an AJAX request to book the appointment
        $.ajax({
            url: '/book-appointment/',  // Update the URL based on your Django project's configuration
            type: 'POST',
            data: { 'time_id': timeId },
            success: function(response) {
                if (response.success) {
                    // Update the UI or refresh the page as needed
                    alert('Appointment booked successfully!');
                    location.reload();  // Refresh the page
                } else {
                    alert('Failed to book the appointment. Please try again.');
                }
            },
            error: function(error) {
                console.error('Error:', error);
                alert('An error occurred while booking the appointment. Please try again.');
            }
        });
    }
</script>

</body>
</html>



# views.py

from django.shortcuts import render
from .models import AppointmentTime

def appointment_time_list(request):
    available_times = AppointmentTime.objects.filter(is_available=True)
    context = {'available_times': available_times}
    return render(request, 'appointment_time_list.html', context)



    # models.py

    from django.db import models
    
    class AppointmentTime(models.Model):
        time = models.TimeField()
        is_available = models.BooleanField(default=True)
    
        def __str__(self):
            return f"{self.time} - {'Available' if self.is_available else 'Occupied'}"
    


            # views.py

from django.http import JsonResponse
from django.views.decorators.http import require_POST
from .models import AppointmentTime

@require_POST
def book_appointment(request):
    time_id = request.POST.get('time_id')
    
    try:
        appointment_time = AppointmentTime.objects.get(id=time_id, is_available=True)
        # Update the availability status
        appointment_time.is_available = False
        appointment_time.save()
        return JsonResponse({'success': True})
    except AppointmentTime.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Time slot not available'})
    except Exception as e:
        return JsonResponse({'success': False, 'error': str(e)})



        # urls.py

from django.urls import path
from .views import appointment_time_list, book_appointment

urlpatterns = [
    path('appointment-times/', appointment_time_list, name='appointment_time_list'),
    path('book-appointment/', book_appointment, name='book_appointment'),
    # ... other paths ...
]
